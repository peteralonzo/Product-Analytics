---------------State Protection Class---------------------------------------------------
(SELECT concat(RISK_ST_ABBR,'Protection Class',(
  case when PRTCT_CLASS_CD in ('1','2','3','4') then 'A. 1-4'   When PRTCT_CLASS_CD in ('5') then 'B. 5'  When PRTCT_CLASS_CD in ('6') then 'C. 6'     When PRTCT_CLASS_CD in ('7') then 'D. 7' 
       When PRTCT_CLASS_CD in ('8','1W','1X','1Y','2W','2X','2Y','3W','3X','3Y','4W','4X','4Y','5W','5X','5Y','6W','6X','6Y','7W','7X','7Y','8W','8B','8X','8Y','9') then 'E. 8-9 and Split'   When PRTCT_CLASS_CD in ('10C','10','10W') then 'f. 10' 
       else 'Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" where POL_FORM_CD is not null GROUP BY Key)

---------------State Protection Class Form ---------------------------------------------------
Union all(SELECT concat(RISK_ST_ABBR,'Protection Class',(
  case when PRTCT_CLASS_CD in ('1','2','3','4') then 'A. 1-4'   When PRTCT_CLASS_CD in ('5') then 'B. 5'  When PRTCT_CLASS_CD in ('6') then 'C. 6'     When PRTCT_CLASS_CD in ('7') then 'D. 7' 
       When PRTCT_CLASS_CD in ('8','1W','1X','1Y','2W','2X','2Y','3W','3X','3Y','4W','4X','4Y','5W','5X','5Y','6W','6X','6Y','7W','7X','7Y','8W','8B','8X','8Y','9') then 'E. 8-9 and Split'   When PRTCT_CLASS_CD in ('10C','10','10W') then 'f. 10' 
       else 'Unknown' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" where POL_FORM_CD is not null GROUP BY Key)

---------------State Account Credit---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Account Credit',(
  ACCT_CR_IND
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, ACCT_CR_IND from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Account Credit Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Account Credit',(
  ACCT_CR_IND
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                           sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, ACCT_CR_IND from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Insurance Score Decile---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Insurance Score Decile',(
  case when ( INS_SCR_CD >= 830 and INS_SCR_CD <= 899 ) then 'Decile 01' 
               when ( INS_SCR_CD >= 804 and INS_SCR_CD <= 829 ) then 'Decile 02'  when ( INS_SCR_CD >= 783 and INS_SCR_CD <= 803 ) then 'Decile 03'  when ( INS_SCR_CD >= 762 and INS_SCR_CD <= 782 ) then 'Decile 04' when ( INS_SCR_CD >= 739 and INS_SCR_CD <= 761 ) then 'Decile 05'  when ( INS_SCR_CD >= 708 and INS_SCR_CD <= 738 ) then 'Decile 06'  when ( INS_SCR_CD >= 663 and INS_SCR_CD <= 707 ) then 'Decile 07' 
               when ( INS_SCR_CD >= 591 and INS_SCR_CD <= 662 ) then 'Decile 08'  when ( INS_SCR_CD >= 484 and INS_SCR_CD <= 590 ) then 'Decile 09'  when ( INS_SCR_CD >= 100 and INS_SCR_CD <= 483 ) then 'Decile 10' else 'NH/NS' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Insurance Score Decile Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Insurance Score Decile',(
  case when ( INS_SCR_CD >= 830 and INS_SCR_CD <= 899 ) then 'Decile 01' when ( INS_SCR_CD >= 804 and INS_SCR_CD <= 829 ) then 'Decile 02'  when ( INS_SCR_CD >= 783 and INS_SCR_CD <= 803 ) then 'Decile 03'  when ( INS_SCR_CD >= 762 and INS_SCR_CD <= 782 ) then 'Decile 04' when ( INS_SCR_CD >= 739 and INS_SCR_CD <= 761 ) then 'Decile 05'  when ( INS_SCR_CD >= 708 and INS_SCR_CD <= 738 ) then 'Decile 06'  when ( INS_SCR_CD >= 663 and INS_SCR_CD <= 707 ) then 'Decile 07' when ( INS_SCR_CD >= 591 and INS_SCR_CD <= 662 ) then 'Decile 08'  when ( INS_SCR_CD >= 484 and INS_SCR_CD <= 590 ) then 'Decile 09'  when ( INS_SCR_CD >= 100 and INS_SCR_CD <= 483 ) then 'Decile 10' else 'NH/NS' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)


---------------State Insured Age Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Insured Age Group',(
case when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=49  then 'a. 25-49' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=54  then 'b. 50-54' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=59  then 'c. 55-59' when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=64  then 'd. 60-64' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=69  then 'e. 65-69' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=74  then 'f. 70-74' when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=79  then 'g. 75-79' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=120  then 'h. 80+' else 'i. null' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Insured Age Group Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Insured Age Group',(
case when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=49  then 'a. 25-49' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=54  then 'b. 50-54' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=59  then 'c. 55-59'
     when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=64  then 'd. 60-64' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=69  then 'e. 65-69' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=74  then 'f. 70-74'
     when   ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=79  then 'g. 75-79' when ((DATEDIFF(Year,ACCT_DOB,POL_EFF_DT)-1)) <=120  then 'h. 80+'
     else 'i. null' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)


---------------State Household Member Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Household Member Count',(
  case when HH_MEMB_CNT = 0 then 'other'  when HH_MEMB_CNT = 1 then 'a. 1' when HH_MEMB_CNT = 2 then 'b. 2' when HH_MEMB_CNT = 3 then 'c. 3'  when HH_MEMB_CNT > 3 and HH_MEMB_CNT <= 12 then 'd. 4+'  else 'other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
      
left join (Select PROP_QTE_TRANS_ID, HH_MEMB_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)
---------------State Household Member Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Household Member Count',(
  case when HH_MEMB_CNT = 0 then 'other'  when HH_MEMB_CNT = 1 then 'a. 1' when HH_MEMB_CNT = 2 then 'b. 2' when HH_MEMB_CNT = 3 then 'c. 3'  when HH_MEMB_CNT > 3 and HH_MEMB_CNT <= 12 then 'd. 4+'  else 'other' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
      
left join (Select PROP_QTE_TRANS_ID, HH_MEMB_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State AARP Member---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'AARP Member',(
case when AARP_MEMB_STAT_DESC = 'Tenured Member' then 'Tenured Member' else 'New Member' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)
---------------State AARP Member Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'AARP Member',(
case when AARP_MEMB_STAT_DESC = 'Tenured Member' then 'Tenured Member' else 'New Member' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State AARP Member Years---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'AARP Member Years',(
  case when AARP_MEMB_DAY_CNT = '0'   then 'A. 0 Days'
       when AARP_MEMB_DAY_CNT <= 364   then 'B. Less than 1 year' when AARP_MEMB_DAY_CNT <= 1824  then 'C. 1-4 years' when AARP_MEMB_DAY_CNT <= 3649  then 'D. 5-9 years' when AARP_MEMB_DAY_CNT <= 5474  then 'E. 10-14 years'
       when AARP_MEMB_DAY_CNT <= 7299  then 'F. 15-19 years'  when AARP_MEMB_DAY_CNT <= 9124  then 'G. 20-24 years'   when AARP_MEMB_DAY_CNT <= 10949 then 'H. 25-29 years'   when AARP_MEMB_DAY_CNT <= 85000   then 'I. 30+ years'
  else 'A. 0 Days' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)
---------------State AARP Member Years Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'AARP Member Years',(
  case when AARP_MEMB_DAY_CNT = '0'   then 'A. 0 Days'
       when AARP_MEMB_DAY_CNT <= 364   then 'B. Less than 1 year' when AARP_MEMB_DAY_CNT <= 1824  then 'C. 1-4 years' when AARP_MEMB_DAY_CNT <= 3649  then 'D. 5-9 years' when AARP_MEMB_DAY_CNT <= 5474  then 'E. 10-14 years'
       when AARP_MEMB_DAY_CNT <= 7299  then 'F. 15-19 years'  when AARP_MEMB_DAY_CNT <= 9124  then 'G. 20-24 years'   when AARP_MEMB_DAY_CNT <= 10949 then 'H. 25-29 years'   when AARP_MEMB_DAY_CNT <= 85000   then 'I. 30+ years'
  else 'A. 0 Days' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Auto AFA Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Auto AFA Count',(
  case when HOME_RATE_PCARR_POL_AFA_CNT = 0 then '0' when HOME_RATE_PCARR_POL_AFA_CNT = 1 then '1'  when HOME_RATE_PCARR_POL_AFA_CNT = 2 then '2+'  when HOME_RATE_PCARR_POL_AFA_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)
---------------State Auto AFA Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Auto AFA Count',(
  case when HOME_RATE_PCARR_POL_AFA_CNT = 0 then '0' when HOME_RATE_PCARR_POL_AFA_CNT = 1 then '1'  when HOME_RATE_PCARR_POL_AFA_CNT = 2 then '2+'  when HOME_RATE_PCARR_POL_AFA_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Auto NAF Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Auto NAF Count',(
  case when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 0 then '0' when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 1 then '1'  when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 2 then '2+'  when HOME_RATE_PCARR_POL_NAF_ACCID_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Auto NAF Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Auto NAF Count',(
  case when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 0 then '0' when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 1 then '1'  when HOME_RATE_PCARR_POL_NAF_ACCID_CNT = 2 then '2+'  when HOME_RATE_PCARR_POL_NAF_ACCID_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)


---------------State Mortgage Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Mortgage Count',(
  case when MTGE_CNT = 0 then '0' when MTGE_CNT = 1 then '1' when MTGE_CNT = 2 then '2+' when MTGE_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Mortgage Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Mortgage Count',(
  case when MTGE_CNT = 0 then '0' when MTGE_CNT = 1 then '1' when MTGE_CNT = 2 then '2+' when MTGE_CNT is null then 'Unknown' else '2+' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Prior CAT Claim Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Prior CAT Claim Count',(
     case when PCARR_CAT_CLM_CNT = 0 then 'A. None'  when PCARR_CAT_CLM_CNT = 1 then 'B. 1'  when PCARR_CAT_CLM_CNT > 1 then 'C. 2+'  when PCARR_CAT_CLM_CNT is null then 'A. None' else 'Unknown' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Prior CAT Claim Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Prior CAT Claim Count',(
     case when PCARR_CAT_CLM_CNT = 0 then 'A. None'  when PCARR_CAT_CLM_CNT = 1 then 'B. 1'  when PCARR_CAT_CLM_CNT > 1 then 'C. 2+'  when PCARR_CAT_CLM_CNT is null then 'A. None' else 'Unknown' end 
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Prior xCAT Claim Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Prior xCAT Claim Count',(
     case when PCARR_XCAT_CLM_CNT = 0 then 'A. None'  when PCARR_XCAT_CLM_CNT = 1 then 'B. 1'  when PCARR_XCAT_CLM_CNT > 1 then 'C. 2+'   when PCARR_XCAT_CLM_CNT is null then 'A. None' else 'Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Prior xCAT Claim Count Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Prior xCAT Claim Count',(
     case when PCARR_XCAT_CLM_CNT = 0 then 'A. None'  when PCARR_XCAT_CLM_CNT = 1 then 'B. 1'  when PCARR_XCAT_CLM_CNT > 1 then 'C. 2+'   when PCARR_XCAT_CLM_CNT is null then 'A. None' else 'Unknown' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Deductible---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Deductible',(
  case when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('500','750')  then 'a. Less than 1000' when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('1000','1500')  then 'b. 1000-1500'
       when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('2000','2500')  then 'c. 2000-2500' when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('3000','4000','5000','7500','10000')  then 'd. 3000+'
       when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD = (1)  then 'e. 0.5%'   when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD in(2,3,4,5,6,7,8)  then 'f. 1.0 or more%'  else 'f. Other' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Deductible Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Deductible',(
  case when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('500','750')  then 'a. Less than 1000' when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('1000','1500')  then 'b. 1000-1500'
       when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('2000','2500')  then 'c. 2000-2500' when COV_DEDUC_AMT_TYP_DESC = 'FLAT' and COV_FLAT_DEDUC_AMT in ('3000','4000','5000','7500','10000')  then 'd. 3000+'
       when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD = (1)  then 'e. 0.5%'   when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD in(2,3,4,5,6,7,8)  then 'f. 1.0 or more%'  else 'f. Other' end 
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Wind Deductible---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Wind Deductible',(
  case when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD = (1)  then '0.5% All Peril'  when COV_DEDUC_AMT_TYP_DESC = 'PERCENT' and COV_PCT_DEDUC_CD in(2,3,4,5,6,7,8)  then '1.0%+ All Peril'   when WND_HAIL_DEDUC_AMT = '0.01'  then '1% Wind Hail'
       when WND_HAIL_DEDUC_AMT = '0.02'  then '2% Wind Hail'   when WND_HAIL_DEDUC_AMT = '0.05'  then '5% Wind Hail'    when WND_HAIL_DEDUC_AMT = '1500'  then 'Other Wind Hail'   when HURR_COV_DEDUC_CD = '1'  then '1% Hurriance'   when HURR_COV_DEDUC_CD = '2'  then '2% Hurricane'  when HURR_COV_DEDUC_CD = '5'  then '5% Hurricane'  when WND_HAIL_DEDUC_AMT is null then 'None'   when WND_HAIL_DEDUC_AMT ='NA' then 'None'
  else 'Other' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Optional Coverage Package---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Optional Coverage Package',( 
 Case when OPT_COV_PKG_CD = 'P1B001'then 'P1' when OPT_COV_PKG_CD = 'P2B001'then 'P2' when OPT_COV_PKG_CD = 'P3B001'then 'P3' when OPT_COV_PKG_CD = 'P1C001'then 'P1' when OPT_COV_PKG_CD = 'P1T001'then 'P1' else 'None' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Optional Coverage Package Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Optional Coverage Package',( 
 Case when OPT_COV_PKG_CD = 'P1B001'then 'P1' when OPT_COV_PKG_CD = 'P2B001'then 'P2' when OPT_COV_PKG_CD = 'P3B001'then 'P3' when OPT_COV_PKG_CD = 'P1C001'then 'P1' when OPT_COV_PKG_CD = 'P1T001'then 'P1' else 'None' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 where POL_FORM_CD is not null GROUP BY Key)

---------------State Coverage A---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Coverage A',( 
  case when COA < 150000 then 'A. <150k'   when COA < 300000 then 'B. 150-299k'  when COA < 375000 then 'C 300-374'  when COA < 450000 then 'D. 375-449k'  when COA < 650000 then 'E. 450-649k' when COA < 1000000 then 'F. 650-1m'  when COA < 12000000 then 'G. 1m+'  else 'Unknown' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID,COA from "DSC_PLBI_DB"."APP_HOME_PRD"."PLBI_PROP_QUOTE_COV_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Square Foot Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Square Foot Group',( 
            case when ( DWELL_TTL_AREA_SQFT_CNT >= 1 and DWELL_TTL_AREA_SQFT_CNT <= 1200 ) then 'a. 1-1200' when ( DWELL_TTL_AREA_SQFT_CNT >= 1201 and DWELL_TTL_AREA_SQFT_CNT <= 1500 ) then 'b. 1201-1500' when ( DWELL_TTL_AREA_SQFT_CNT >= 1501 and DWELL_TTL_AREA_SQFT_CNT <= 2000 ) then 'c. 1501-2000' 
               when ( DWELL_TTL_AREA_SQFT_CNT >= 2001 and DWELL_TTL_AREA_SQFT_CNT <= 2500 ) then 'd. 2001-2500' when ( DWELL_TTL_AREA_SQFT_CNT >= 2501 and DWELL_TTL_AREA_SQFT_CNT <= 3000 ) then 'e. 2501-3000' when ( DWELL_TTL_AREA_SQFT_CNT >= 3001 and DWELL_TTL_AREA_SQFT_CNT <= 9999 ) then 'f. 3001+' 
else 'Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, DWELL_TTL_AREA_SQFT_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)
---------------State Cov A Per SqFt Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Cov A Per SqFt',( 
case when round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) >= 0 and round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) <= 169  then 'a. Less than 170'   when round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) >= 170 and round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) <= 189 then 'b. 170-189' 
     when round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) >= 190 and round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) <= 209 then 'c. 190-209'  when round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) >= 210 and round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) <= 239 then 'd. 210-239' 
     when round(DIV0NULL(COA,DWELL_TTL_AREA_SQFT_CNT),0) >= 240 then 'e. 240+' 
else 'Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
left join (Select PROP_QTE_TRANS_ID, COA from "DSC_PLBI_DB"."APP_HOME_PRD"."PLBI_PROP_QUOTE_COV_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID left join (Select PROP_QTE_TRANS_ID, DWELL_TTL_AREA_SQFT_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t4 on t1.PROP_QTE_TRANS_ID = t4.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)


---------------State Dwelling Age Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Dwelling Age Group',( 
  case when DWELL_AGE <= 5 then 'A. 0-5'   when DWELL_AGE <= 10 then 'B. 6-10' when DWELL_AGE <= 20 then 'C 11-20'  when DWELL_AGE <= 30 then 'D. 21-30'   when DWELL_AGE <= 40 then 'E. 31-40'    when DWELL_AGE <= 50 then 'F. 41-50'  
       when DWELL_AGE <= 60 then 'G. 51-60' when DWELL_AGE <= 70 then 'H. 61-70'  when DWELL_AGE <= 200 then 'I. 71+' else 'Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, DWELL_AGE from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Roof Age Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Roof Age Group',( 
  case when PROP_ROOF_AGE <= 5 then 'A. 0-5'    when PROP_ROOF_AGE <= 10 then 'B. 6-10'  when PROP_ROOF_AGE <= 20 then 'C 11-20'  when PROP_ROOF_AGE <= 200 then 'D. 21+'  else 'Unknown' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 left join (Select PROP_QTE_TRANS_ID, PROP_ROOF_AGE from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Roof SqFt Size---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Roof SqFt Size',( 
  case when AERIAL_ROOF_SQFT_CNT is null then 'G. Unknown' when AERIAL_ROOF_SQFT_CNT <1300 then 'A. Less than 1300'  when AERIAL_ROOF_SQFT_CNT <2000 then 'B. 1300-1999'   when AERIAL_ROOF_SQFT_CNT <2500 then 'C. 2000-2499' 
       when AERIAL_ROOF_SQFT_CNT <3000 then 'D. 2500-2999' when AERIAL_ROOF_SQFT_CNT <4000 then 'E. 3000-3999'      when AERIAL_ROOF_SQFT_CNT <300000 then 'F. 4000+' else 'G. Unknown' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, AERIAL_ROOF_SQFT_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Hail Roof Symbol Group---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Hail Roof Symbol Group',( 
case when HAIL_PERIL_ROOF_SYM_CD = 'R0' then 'a. R0'  when HAIL_PERIL_ROOF_SYM_CD in ('R1', 'R2', 'R3', 'R4', 'R5', 'R6', 'R7', 'R8', 'R9', 'R10') then 'b. R1-R10'  when HAIL_PERIL_ROOF_SYM_CD in ('R11', 'R12', 'R13', 'R14', 'R15', 'R16', 'R17', 'R18', 'R19', 'R20','R21', 'R22', 'R23', 'R24', 'R25') then 'c. R11-R25'  when HAIL_PERIL_ROOF_SYM_CD in ('R26', 'R27', 'R28', 'R29', 'R30', 'R31', 'R32', 'R33', 'R34', 'R35','R36', 'R37', 'R38', 'R39', 'R40') then 'd. R26-R40'   when HAIL_PERIL_ROOF_SYM_CD in ('R41', 'R42', 'R43', 'R44', 'R45', 'R46', 'R47', 'R48', 'R49', 'R50','R51', 'R52', 'R53', 'R54', 'R55','R56', 'R57', 'R58', 'R59') then 'e. R41-R59' when HAIL_PERIL_ROOF_SYM_CD in ('R60', 'R61', 'R62', 'R63', 'R64', 'R65', 'R66', 'R67', 'R68', 'R69','R70', 'R71', 'R72', 'R73', 'R74', 'R75','R76', 'R77', 'R78', 'R79','R80', 'R81', 'R82', 'R83', 'R84', 'R85', 'R86', 'R87', 'R88', 'R89','R90','R91', 'R92', 'R93', 'R94', 'R95','R96', 'R97', 'R98', 'R99') then 'f. R60-R99' else 'g. null' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, AERIAL_ROOF_SQFT_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Roof Condition Score---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Roof Condition Score',( 
roof_cond_deriv_scr_num
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 left join (Select PROP_QTE_TRANS_ID, roof_cond_deriv_scr_num from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State  Roof Shape---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Roof Shape',( 
    case when DERIV_ROOF_SHAPE_DESC = 'gable' then 'a. Gable'  when DERIV_ROOF_SHAPE_DESC = 'hip' then 'b. Hip'  when DERIV_ROOF_SHAPE_DESC = 'mixed' then 'c. Mixed'  when DERIV_ROOF_SHAPE_DESC = 'flat' then 'd. Flat'   when DERIV_ROOF_SHAPE_DESC is null then 'f. Blank'  else 'e. Other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, DERIV_ROOF_SHAPE_DESC from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Build Fax Roof Age Confidence---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Build Fax Roof Age Confidence',( 
    case when BLD_FAX_ROOF_AGE_CONFID_DESC in( 'High','9') then 'a. High/9' when BLD_FAX_ROOF_AGE_CONFID_DESC  in ('Medium','8') then 'b. Medium/8' when BLD_FAX_ROOF_AGE_CONFID_DESC in ('Low','7') then 'c. Low/7'  when BLD_FAX_ROOF_AGE_CONFID_DESC in ('Modeled','5') then 'd. Modeled/5'
         when BLD_FAX_ROOF_AGE_CONFID_DESC is null then 'e. Other/Unknown' else 'e. Other/Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
      left join (Select PROP_QTE_TRANS_ID, BLD_FAX_ROOF_AGE_CONFID_DESC from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)


---------------State Tree Overhang---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Tree Overhang',( 
    case when ROOF_TREE_CANPY_STAT_DESC = 'tree_overhang_major' then 'a. Major' when ROOF_TREE_CANPY_STAT_DESC = 'tree_overhang_moderate' then 'b. Moderate'  when ROOF_TREE_CANPY_STAT_DESC = 'tree_overhang_minor' then 'c. Minor'  when ROOF_TREE_CANPY_STAT_DESC = 'no_tree_overhang' then 'd. No Overhang'
         when ROOF_TREE_CANPY_STAT_DESC = 'not_available' then 'e. Unkn/NotAvail/Blank'  when ROOF_TREE_CANPY_STAT_DESC = 'unknown' then 'e. Unkn/NotAvail/Blank'  when ROOF_TREE_CANPY_STAT_DESC is null then 'e. Unkn/NotAvail/Blank'  else 'e. Unkn/NotAvail/Blank' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, ROOF_TREE_CANPY_STAT_DESC from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Cape Coverage---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Cape Coverage',( 
  case when CAPE_ANAL_SRVC_ERR_MSG_DESC = 'API request was successful'  then 'a. Cape Hit'
       when left(CAPE_ANAL_SRVC_ERR_MSG_DESC,35) = 'The input location is outside of Ca' then 'b. Outside of Cape Coverage'
       when CAPE_ANAL_SRVC_ERR_MSG_DESC is null then 'd. Blank'
  else 'c. Other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, ROOF_TREE_CANPY_STAT_DESC from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID
where POL_FORM_CD is not null GROUP BY Key)

---------------State Construction Material---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Construction Material',( 
case when Dwell_Rate_Constr_Typ_Desc in ('Frame','Masonry','MasonryVeneer') then Dwell_Rate_Constr_Typ_Desc else 'Superior/Other/Unknown'end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID,  Dwell_Rate_Constr_Typ_Desc from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID
where POL_FORM_CD is not null GROUP BY Key)

---------------State Story Count---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Story Count',( 
 case when DWELL_STRY_CNT_CD = '1' then 'a. 1'
       when DWELL_STRY_CNT_CD = '1.5' then 'b. 1.5'
       when DWELL_STRY_CNT_CD = '2' then 'c. 2'
       when DWELL_STRY_CNT_CD in ('2','2.5','3','3.5','4','4.5','5') then 'd. 2.5+'
       when DWELL_STRY_CNT_CD in ('BI','SPLIT') then 'E. BI/SPLIT'
       when DWELL_STRY_CNT_CD is null then 'f. Other/Unknown'
        else 'f. Other/Unknown' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, DWELL_STRY_CNT_CD from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Fire Alarm---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Fire Alarm',( 
  case when FIRE_ALARM_DESC = 'Monitored' then 'a. Monitored'
       when FIRE_ALARM_DESC = 'NonMonitored' then 'b. Non-Monitored'
       when FIRE_ALARM_DESC = 'None' then 'c. None'
       when FIRE_ALARM_DESC is null then 'd. Blank'
        else 'e. Other' end 
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, FIRE_ALARM_DESC        
           from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Fire Alarm Form---------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Fire Alarm',( 
  case when FIRE_ALARM_DESC = 'Monitored' then 'a. Monitored'
       when FIRE_ALARM_DESC = 'NonMonitored' then 'b. Non-Monitored'
       when FIRE_ALARM_DESC = 'None' then 'c. None'
       when FIRE_ALARM_DESC is null then 'd. Blank'
        else 'e. Other' end 
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
   left join (Select PROP_QTE_TRANS_ID, FIRE_ALARM_DESC        
           from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)


---------------State Distance To Coast--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Distance to Coast',( 
  case when RISK_ST_ABBR in('AK','AR','IA','ID','IL','MN','MO','IN','KS','KY','NM','OH','OK','UT','WI','WV','VT','SD','TN','WY','ND','NE','OR','PA','MI','AZ','CO','MT') then 'A. Non DTC State'
       when RATE_DSTNC_TO_COAST_FT_CNT <= 2000 then 'b. 0-2000'       when RATE_DSTNC_TO_COAST_FT_CNT > 2000 and RATE_DSTNC_TO_COAST_FT_CNT <= 5280 then 'c. 2001-5280'       when RATE_DSTNC_TO_COAST_FT_CNT > 5280 and RATE_DSTNC_TO_COAST_FT_CNT <= 26399 then 'd. 1-4 miles'
       when RATE_DSTNC_TO_COAST_FT_CNT > 26400 and RATE_DSTNC_TO_COAST_FT_CNT <= 52799 then 'e. 5-9 miles'       when RATE_DSTNC_TO_COAST_FT_CNT > 52800 and RATE_DSTNC_TO_COAST_FT_CNT <= 105599 then 'f. 10-19 miles'        when RATE_DSTNC_TO_COAST_FT_CNT > 105600 and RATE_DSTNC_TO_COAST_FT_CNT <= 263999 then 'g. 20-49 miles'       when RATE_DSTNC_TO_COAST_FT_CNT > 264000 and RATE_DSTNC_TO_COAST_FT_CNT <= 395999 then 'h. 50-74 miles'        when RATE_DSTNC_TO_COAST_FT_CNT > 396000 and RATE_DSTNC_TO_COAST_FT_CNT <= 527999 then 'i. 75-99 miles'        when RATE_DSTNC_TO_COAST_FT_CNT > 528000 and RATE_DSTNC_TO_COAST_FT_CNT <= 791999 then 'j. 100-149 miles'        when RATE_DSTNC_TO_COAST_FT_CNT > 792000 and RATE_DSTNC_TO_COAST_FT_CNT <= 9999998 then 'k. 150+ miles' 
       when RATE_DSTNC_TO_COAST_FT_CNT = 9999999 then 'l 9999999 feet'
        else 'other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 left join (Select PROP_QTE_TRANS_ID, RATE_DSTNC_TO_COAST_FT_CNT from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Fireline Score--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Fireline Score',( 
   case when FIRELN_WLDFR_RISK_SCR_NUM = 0 then '0' when FIRELN_WLDFR_RISK_SCR_NUM = 1 then '1' when FIRELN_WLDFR_RISK_SCR_NUM = 2 then '2' when FIRELN_WLDFR_RISK_SCR_NUM = 3 then '3' when FIRELN_WLDFR_RISK_SCR_NUM = 4 then '4' when FIRELN_WLDFR_RISK_SCR_NUM = 5 then '5'  
 when FIRELN_WLDFR_RISK_SCR_NUM = 6 then '6'  when FIRELN_WLDFR_RISK_SCR_NUM = 7 then '7+' when FIRELN_WLDFR_RISK_SCR_NUM > 7 then '7+' when FIRELN_WLDFR_RISK_SCR_NUM is null then 'N/A'  else 'other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1 left join (Select PROP_QTE_TRANS_ID, FIRELN_WLDFR_RISK_SCR_NUM from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3
                       
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State HazardHub--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'HazardHub',( 
  case when HAZ_HUB_WLDFR_SCR_NUM < 18 then 'A. 0-17' when HAZ_HUB_WLDFR_SCR_NUM < 21 then 'B. 18-20'  when HAZ_HUB_WLDFR_SCR_NUM < 27 then 'C. 21-26'  when HAZ_HUB_WLDFR_SCR_NUM < 34 then 'D. 27-33' when HAZ_HUB_WLDFR_SCR_NUM < 98 then 'E. 34-97'  when HAZ_HUB_WLDFR_SCR_NUM in ('98','99') then 'F. NH/NS'  else 'other' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1

left join (Select PROP_QTE_TRANS_ID, HAZ_HUB_WLDFR_SCR_NUM from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3             
on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID where POL_FORM_CD is not null GROUP BY Key)

---------------State Limited Access--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Limited Access',( 
  LTD_ACCSS_CR_IND
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1

   left join (Select PROP_QTE_TRANS_ID, LTD_ACCSS_CR_IND from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t3 on t1.PROP_QTE_TRANS_ID = t3.PROP_QTE_TRANS_ID
                       
where POL_FORM_CD is not null GROUP BY Key)

---------------State Dwelling Substate--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Dwelling Substate',( 
   case when RISK_ST_ABBR = 'IA' and GARAGE_SUBSTATE in ('Cedar Rapids/Iowa City metro', 'Central Iowa', 'Des Moines/Ames Metro', 'East Iowa', 'West Iowa/KS border') then GARAGE_SUBSTATE 
        when RISK_ST_ABBR <> 'IA' and left(RISK_ST_ABBR,2)=left(GARAGE_SUBSTATE,2) then GARAGE_SUBSTATE else 'Out of State Mail' end
        ),BU_ABBR,'NewCo','Total') as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
       left join (Select PROP_QTE_TRANS_ID, DWELL_LOC_ADDR_FULL_ZIP_CD        
           from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t7
                       
on t1.PROP_QTE_TRANS_ID = t7.PROP_QTE_TRANS_ID
left join (Select ZIP_CODE, STATE_ABBR, GARAGE_SUBSTATE from "DSC_PLBI_DB"."APP_AUTO_PRD"."STATE_PRODUCT_SUBSTATE") t2 on t2.ZIP_CODE = left(DWELL_LOC_ADDR_FULL_ZIP_CD,5) where POL_FORM_CD is not null GROUP BY Key)

---------------State Dwelling Substate Form--------------------------------------------------
Union all (SELECT concat(RISK_ST_ABBR,'Dwelling Substate',( 
   case when RISK_ST_ABBR = 'IA' and GARAGE_SUBSTATE in ('Cedar Rapids/Iowa City metro', 'Central Iowa', 'Des Moines/Ames Metro', 'East Iowa', 'West Iowa/KS border') then GARAGE_SUBSTATE 
        when RISK_ST_ABBR <> 'IA' and left(RISK_ST_ABBR,2)=left(GARAGE_SUBSTATE,2) then GARAGE_SUBSTATE else 'Out of State Mail' end
        ),BU_ABBR,'NewCo',(case when POL_FORM_CD in ('HO3','HO5','3','5','HO7') then 'Bldg' when POL_FORM_CD in ('HO4','HO6','4','6') then 'T/C' else 'Other' end)) as Key,

        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Response",                                                                                                                                                                  sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Response", sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 Response", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND RESP_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 Response", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=12 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=11 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())=10 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 PBR",                                                                               sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 9 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "09 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 8 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "08 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 7 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "07 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 6 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "06 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 5 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "05 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 4 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "04 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 3 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "03 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 2 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "02 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 1 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "01 PBR", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN COMPL_QTE_IND_CNT when Datediff(month,TRANS_DT,sysdate())= 0 AND QQ_IND_CNT=1 THEN 1 ELSE 0 END) AS "00 PBR", 
        sum(case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "12 Issued",                                                                                                                                                                   sum(case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "11 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "10 Issued",sum(case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "9 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "8 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "7 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "6 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "5 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "4 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "3 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "2 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "1 Issued", sum(case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN 1 ELSE 0 END) AS "0 Issued", 
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "12 AQP",                                                                                                         nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "11 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "10 AQP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "9 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "8 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "7 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "6 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "5 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "4 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "3 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "2 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "1 AQP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND COMPL_QTE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/COMPL_QTE_IND_CNT) ELSE null END))) AS "0 AQP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "12 AIP",                                                                                                                 nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "11 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "10 AIP",nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "9 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "8 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "7 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "6 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "5 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "4 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "3 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "2 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "1 AIP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 AND ISSUE_IND_CNT=1 THEN (POL_TTL_BILL_PREM_AMT/ISSUE_IND_CNT) ELSE null END))) AS "0 AIP",   
        nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=12 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "12 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=11 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "11 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())=10 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "10 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 9 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "09 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 8 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "08 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 7 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "07 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 6 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "06 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 5 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "05 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 4 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "04 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 3 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "03 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 2 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "02 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 1 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "01 Phone HIGSRP", nullifzero(Avg((case when Datediff(month,TRANS_DT,sysdate())= 0 and QQ_IND_CNT=1 AND PCARR_POL_TERM_TTL_PREM_AMT >= 300 AND POL_TTL_BILL_PREM_AMT > 0 and ORIG_QTE_CNTCT_METH_CD = 'P' THEN (QQ_ANNL_POL_PREM_AMT/PCARR_POL_TERM_TTL_PREM_AMT) else null end))) as "00 Phone HIGSRP",  
 TO_CHAR(sysdate(),'MM-DD-YYYY') as AS_OF
FROM  "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_LATST_VW" t1
       left join (Select PROP_QTE_TRANS_ID, DWELL_LOC_ADDR_FULL_ZIP_CD        
           from "PRD_PL_DB"."APP_DCPA_DM"."PROP_QUOTE_DWELL_LATST_VW") t7
                       
on t1.PROP_QTE_TRANS_ID = t7.PROP_QTE_TRANS_ID left join (Select ZIP_CODE, STATE_ABBR, GARAGE_SUBSTATE from "DSC_PLBI_DB"."APP_AUTO_PRD"."STATE_PRODUCT_SUBSTATE") t2 on t2.ZIP_CODE = left(DWELL_LOC_ADDR_FULL_ZIP_CD,5) where POL_FORM_CD is not null GROUP BY Key)
order by Key