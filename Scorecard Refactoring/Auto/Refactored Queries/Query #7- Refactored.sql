WITH market_index AS -- Segmenting funnel data by market index
(
    SELECT CONCAT(STATE_ABBR, 'Market Index', (CASE WHEN MKT_INDX_CTGY_CD IS NULL THEN 'unknown' else MKT_INDX_CTGY_CD END)) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

aarp_member AS -- Segmenting funnel data by AARP member status
(
	SELECT CONCAT(STATE_ABBR, 'AARP Member Status', AARP_MEMB_STTS_DESCR) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

aarp_thru AS -- Segmenting funnel data by AARP thru agent indicator
(
	SELECT CONCAT(STATE_ABBR, 'AARP Thru Agent', AARP_THRU_AGNT_IND) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

pcarr AS -- Segmenting funnel data by prior carrier
(
	SELECT CONCAT(STATE_ABBR, 'Prior Carrier',
           CASE WHEN PCARR_DESC in ('OTHER - STANDARD','NOT PRESENTLY INSURED','PROGRESSIVE','HARTFORD',
			   'OTHER - NON STANDARD','SAFECO','STATE FARM','TRAVELERS','ALLSTATE','AMERICAN NATIONAL','GEICO','NATIONWIDE') THEN PCARR_DESC 
			    ELSE 'OTHER - ALL OTHER' END) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

pcarr_yr AS -- Segmenting funnel data by prior carrier year count
(
	SELECT CONCAT(STATE_ABBR, 'Prior Carrier Year Count', PCARR_YR_CNT) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

full_pay AS --Segmenting funnel data by Full Pay Discount
(
	SELECT CONCAT(STATE_ABBR, 'Full Pay Discount', FULL_PAY_DISCOUNT_IND) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

aqd_group AS -- Segmenting funnel data by AQD group
(
	SELECT CONCAT(STATE_ABBR, 'AQD Group', AQD_GRP) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

acct_credit AS -- Segmenting funnel data by account credit indicator
(
	SELECT CONCAT(STATE_ABBR, 'Account Credit', ACCT_CR_IND) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

ins_age AS -- Segmenting funnel data by insured age group
(
	SELECT CONCAT(STATE_ABBR, 'Insured Age Group', INSURED_AGE_GRP) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

ins_score AS -- Segmenting funnel data by insurance score
(
	SELECT CONCAT(STATE_ABBR,'Insurance Score',
           CASE WHEN INS_SCORE_CD IN ('000','999','NUS','XXX','ERR') THEN 'NHNS' 
				WHEN INS_SCORE_CD IS NULL THEN 'NHNS'
                WHEN INS_SCORE_CD = '800' THEN '800'
				WHEN INS_SCORE_CD BETWEEN 1 AND 614 THEN '1 to 614'
				WHEN INS_SCORE_CD BETWEEN 615 AND 699 THEN '615 to 699'
				WHEN INS_SCORE_CD BETWEEN 700 AND 754 THEN '700 to 754'
				WHEN INS_SCORE_CD BETWEEN 755 AND 789 THEN '755 to 789'
				WHEN INS_SCORE_CD BETWEEN 790 AND 809 THEN '790 to 809'
				WHEN INS_SCORE_CD BETWEEN 810 AND 824 THEN '810 to 824'
				WHEN INS_SCORE_CD BETWEEN 825 AND 840 THEN '825 to 840'
				WHEN INS_SCORE_CD BETWEEN 841 AND 865 THEN '841 to 865'
				WHEN INS_SCORE_CD BETWEEN 866 AND 893 THEN '866 to 893'
				WHEN INS_SCORE_CD BETWEEN 894 AND 979 THEN '894+' else INS_SCORE_CD END) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

veh_cnt AS -- Segmenting funnel data by vehicle count
(
	SELECT CONCAT(STATE_ABBR, 'Veh Count', NUM_VEH) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

avg_mileage AS -- Segmenting funnel data by average mileage
(
	SELECT CONCAT(STATE_ABBR,'AVG Annual Mileage',
           CASE WHEN AVERAGE_ANNUAL_MILAGE < 7000 THEN 'Less than 7000' 
                WHEN AVERAGE_ANNUAL_MILAGE BETWEEN 7000 AND 8999 THEN '7000-8999' 
                WHEN AVERAGE_ANNUAL_MILAGE = 9000 THEN '9000'
                WHEN AVERAGE_ANNUAL_MILAGE BETWEEN 9001 AND 12499 THEN '9001-12499' 
                WHEN AVERAGE_ANNUAL_MILAGE >= 12500 THEN '12500+' else 'unknown' END) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

youthful AS -- Segmenting funnel data by youthful indicator
(
	SELECT CONCAT(STATE_ABBR, 'Youthful', YOUTHFUL_IND) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

household_comp AS -- Segmenting funnel data by household comp
(
	SELECT CONCAT(STATE_ABBR, 'Household Comp', HH_COMP) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

cov_pkg AS -- Segmenting funnel data by coverage package
(
	SELECT CONCAT(STATE_ABBR,'Coverage Package Code', POL_COV_PKG_CD) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

bi_limit AS -- Segmenting funnel data by BI limit
(
	SELECT CONCAT(STATE_ABBR,'Prior BI Limit',
           CASE WHEN PRIOR_CARR_BI_PERSON_LMT IN ('0010','0015','0020','0025','0030') THEN '10 to 30'
                WHEN PRIOR_CARR_BI_PERSON_LMT IN ('0050','0055','0060','0065','0070','0075') THEN '50 to 75'
                WHEN PRIOR_CARR_BI_PERSON_LMT IN ('0100','0150') THEN '100 to 150'
                WHEN PRIOR_CARR_BI_PERSON_LMT IN ('0200','0250','0300','0500') THEN '200 to 500' else 'unknown' END) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
),

garage_sub AS -- Segmenting funnel data by garage_sub
(
	SELECT CONCAT(STATE_ABBR, 'Garage Substate',
    CASE WHEN LEFT(STATE_ABBR,2) = LEFT(GARAGE_SUBSTATE,2) THEN GARAGE_SUBSTATE ELSE 'Out of State Mail' END) as Key,
    -- RC1
    rc1_funnel_scorecard(14, QUOTE_DT, QCN) AS "14 RC1",
    rc1_funnel_scorecard(13, QUOTE_DT, QCN) AS "13 RC1",
    rc1_funnel_scorecard(12, QUOTE_DT, QCN) AS "12 RC1",
    rc1_funnel_scorecard(11, QUOTE_DT, QCN) AS "11 RC1",
    rc1_funnel_scorecard(10, QUOTE_DT, QCN) AS "10 RC1",
    rc1_funnel_scorecard(9, QUOTE_DT, QCN) AS " 9 RC1",
    rc1_funnel_scorecard(8, QUOTE_DT, QCN) AS " 8 RC1",
    rc1_funnel_scorecard(7, QUOTE_DT, QCN) AS " 7 RC1",
    rc1_funnel_scorecard(6, QUOTE_DT, QCN) AS " 6 RC1",
    rc1_funnel_scorecard(5, QUOTE_DT, QCN) AS " 5 RC1",
    rc1_funnel_scorecard(4, QUOTE_DT, QCN) AS " 4 RC1",
    rc1_funnel_scorecard(3, QUOTE_DT, QCN) AS " 3 RC1",
    rc1_funnel_scorecard(2, QUOTE_DT, QCN) AS " 2 RC1",
    -- FAILS
    ind_funnel_scorecard(14, QUOTE_DT, FAILURE_IND) AS "14 FAIL",
    ind_funnel_scorecard(13, QUOTE_DT, FAILURE_IND) AS "13 FAIL",
    ind_funnel_scorecard(12, QUOTE_DT, FAILURE_IND) AS "12 FAIL",
    ind_funnel_scorecard(11, QUOTE_DT, FAILURE_IND) AS "11 FAIL",
    ind_funnel_scorecard(10, QUOTE_DT, FAILURE_IND) AS "10 FAIL",
    ind_funnel_scorecard(9, QUOTE_DT, FAILURE_IND) AS "9 FAIL",
    ind_funnel_scorecard(8, QUOTE_DT, FAILURE_IND) AS "8 FAIL",
    ind_funnel_scorecard(7, QUOTE_DT, FAILURE_IND) AS "7 FAIL",
    ind_funnel_scorecard(6, QUOTE_DT, FAILURE_IND) AS "6 FAIL",
    ind_funnel_scorecard(5, QUOTE_DT, FAILURE_IND) AS "5 FAIL",
    ind_funnel_scorecard(4, QUOTE_DT, FAILURE_IND) AS "4 FAIL",
    ind_funnel_scorecard(3, QUOTE_DT, FAILURE_IND) AS "3 FAIL",
    ind_funnel_scorecard(2, QUOTE_DT, FAILURE_IND) AS "2 FAIL",
    -- SUCCESSES
    ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND) AS "14 SUCCESS",
    ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND) AS "13 SUCCESS",
    ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND) AS "12 SUCCESS",
    ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND) AS "11 SUCCESS",
    ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND) AS "10 SUCCESS",
    ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND) AS "9 SUCCESS",
    ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND) AS "8 SUCCESS",
    ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND) AS "7 SUCCESS",
    ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND) AS "6 SUCCESS",
    ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND) AS "5 SUCCESS",
    ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND) AS "4 SUCCESS",
    ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND) AS "3 SUCCESS",
    ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND) AS "2 SUCCESS",
    -- SUCCESSES 2+
    adv_ind_funnel_scorecard(14, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "14 SUCCESS_2+",
    adv_ind_funnel_scorecard(13, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "13 SUCCESS_2+",
    adv_ind_funnel_scorecard(12, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "12 SUCCESS_2+",
    adv_ind_funnel_scorecard(11, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "11 SUCCESS_2+",
    adv_ind_funnel_scorecard(10, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "10 SUCCESS_2+",
    adv_ind_funnel_scorecard(9, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "9 SUCCESS_2+",
    adv_ind_funnel_scorecard(8, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "8 SUCCESS_2+",
    adv_ind_funnel_scorecard(7, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "7 SUCCESS_2+",
    adv_ind_funnel_scorecard(6, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "6 SUCCESS_2+",
    adv_ind_funnel_scorecard(5, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "5 SUCCESS_2+",
    adv_ind_funnel_scorecard(4, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "4 SUCCESS_2+",
    adv_ind_funnel_scorecard(3, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "3 SUCCESS_2+",
    adv_ind_funnel_scorecard(2, QUOTE_DT, SUCCESS_IND, CARRIERSQUOTED) AS "2 SUCCESS_2+",
    -- COMPETITIVE
	ind_funnel_scorecard(14, QUOTE_DT, COMPETITIVE_IND) AS "14 COMPETITIVE",
    ind_funnel_scorecard(13, QUOTE_DT, COMPETITIVE_IND) AS "13 COMPETITIVE",
    ind_funnel_scorecard(12, QUOTE_DT, COMPETITIVE_IND) AS "12 COMPETITIVE",
    ind_funnel_scorecard(11, QUOTE_DT, COMPETITIVE_IND) AS "11 COMPETITIVE",
    ind_funnel_scorecard(10, QUOTE_DT, COMPETITIVE_IND) AS "10 COMPETITIVE",
    ind_funnel_scorecard(9, QUOTE_DT, COMPETITIVE_IND) AS "9 COMPETITIVE",
    ind_funnel_scorecard(8, QUOTE_DT, COMPETITIVE_IND) AS "8 COMPETITIVE",
    ind_funnel_scorecard(7, QUOTE_DT, COMPETITIVE_IND) AS "7 COMPETITIVE",
    ind_funnel_scorecard(6, QUOTE_DT, COMPETITIVE_IND) AS "6 COMPETITIVE",
    ind_funnel_scorecard(5, QUOTE_DT, COMPETITIVE_IND) AS "5 COMPETITIVE",
    ind_funnel_scorecard(4, QUOTE_DT, COMPETITIVE_IND) AS "4 COMPETITIVE",
    ind_funnel_scorecard(3, QUOTE_DT, COMPETITIVE_IND) AS "3 COMPETITIVE",
    ind_funnel_scorecard(2, QUOTE_DT, COMPETITIVE_IND) AS "2 COMPETITIVE",
	-- WIN
	ind_funnel_scorecard(14, QUOTE_DT, WIN_IND) AS "14 WIN",
    ind_funnel_scorecard(13, QUOTE_DT, WIN_IND) AS "13 WIN",
    ind_funnel_scorecard(12, QUOTE_DT, WIN_IND) AS "12 WIN",
    ind_funnel_scorecard(11, QUOTE_DT, WIN_IND) AS "11 WIN",
    ind_funnel_scorecard(10, QUOTE_DT, WIN_IND) AS "10 WIN",
    ind_funnel_scorecard(9, QUOTE_DT, WIN_IND) AS "9 WIN",
    ind_funnel_scorecard(8, QUOTE_DT, WIN_IND) AS "8 WIN",
    ind_funnel_scorecard(7, QUOTE_DT, WIN_IND) AS "7 WIN",
    ind_funnel_scorecard(6, QUOTE_DT, WIN_IND) AS "6 WIN",
    ind_funnel_scorecard(5, QUOTE_DT, WIN_IND) AS "5 WIN",
    ind_funnel_scorecard(4, QUOTE_DT, WIN_IND) AS "4 WIN",
    ind_funnel_scorecard(3, QUOTE_DT, WIN_IND) AS "3 WIN",
    ind_funnel_scorecard(2, QUOTE_DT, WIN_IND) AS "2 WIN",
	-- CQ
	ind_funnel_scorecard(14, QUOTE_DT, COMPL_QTE_IND_CNT) AS "14 CQ",
    ind_funnel_scorecard(13, QUOTE_DT, COMPL_QTE_IND_CNT) AS "13 CQ",
    ind_funnel_scorecard(12, QUOTE_DT, COMPL_QTE_IND_CNT) AS "12 CQ",
    ind_funnel_scorecard(11, QUOTE_DT, COMPL_QTE_IND_CNT) AS "11 CQ",
    ind_funnel_scorecard(10, QUOTE_DT, COMPL_QTE_IND_CNT) AS "10 CQ",
    ind_funnel_scorecard(9, QUOTE_DT, COMPL_QTE_IND_CNT) AS "9 CQ",
    ind_funnel_scorecard(8, QUOTE_DT, COMPL_QTE_IND_CNT) AS "8 CQ",
    ind_funnel_scorecard(7, QUOTE_DT, COMPL_QTE_IND_CNT) AS "7 CQ",
    ind_funnel_scorecard(6, QUOTE_DT, COMPL_QTE_IND_CNT) AS "6 CQ",
    ind_funnel_scorecard(5, QUOTE_DT, COMPL_QTE_IND_CNT) AS "5 CQ",
    ind_funnel_scorecard(4, QUOTE_DT, COMPL_QTE_IND_CNT) AS "4 CQ",
    ind_funnel_scorecard(3, QUOTE_DT, COMPL_QTE_IND_CNT) AS "3 CQ",
    ind_funnel_scorecard(2, QUOTE_DT, COMPL_QTE_IND_CNT) AS "2 CQ",
    -- Issue
    ind_funnel_scorecard(14, QUOTE_DT, ISS_IND_CNT) AS "14 ISSUE",
    ind_funnel_scorecard(13, QUOTE_DT, ISS_IND_CNT) AS "13 ISSUE",
    ind_funnel_scorecard(12, QUOTE_DT, ISS_IND_CNT) AS "12 ISSUE",
    ind_funnel_scorecard(11, QUOTE_DT, ISS_IND_CNT) AS "11 ISSUE",
    ind_funnel_scorecard(10, QUOTE_DT, ISS_IND_CNT) AS "10 ISSUE",
    ind_funnel_scorecard(9, QUOTE_DT, ISS_IND_CNT) AS "9 ISSUE",
    ind_funnel_scorecard(8, QUOTE_DT, ISS_IND_CNT) AS "8 ISSUE",
    ind_funnel_scorecard(7, QUOTE_DT, ISS_IND_CNT) AS "7 ISSUE",
    ind_funnel_scorecard(6, QUOTE_DT, ISS_IND_CNT) AS "6 ISSUE",
    ind_funnel_scorecard(5, QUOTE_DT, ISS_IND_CNT) AS "5 ISSUE",
    ind_funnel_scorecard(4, QUOTE_DT, ISS_IND_CNT) AS "4 ISSUE",
    ind_funnel_scorecard(3, QUOTE_DT, ISS_IND_CNT) AS "3 ISSUE",
    ind_funnel_scorecard(2, QUOTE_DT, ISS_IND_CNT) AS "2 ISSUE",
    -- Bridge
    ind_funnel_scorecard(14, QUOTE_DT, BRIDGED_IND_CNT) AS "14 BRIDGE",
    ind_funnel_scorecard(13, QUOTE_DT, BRIDGED_IND_CNT) AS "13 BRIDGE",
    ind_funnel_scorecard(12, QUOTE_DT, BRIDGED_IND_CNT) AS "12 BRIDGE",
    ind_funnel_scorecard(11, QUOTE_DT, BRIDGED_IND_CNT) AS "11 BRIDGE",
    ind_funnel_scorecard(10, QUOTE_DT, BRIDGED_IND_CNT) AS "10 BRIDGE",
    ind_funnel_scorecard(9, QUOTE_DT, BRIDGED_IND_CNT) AS "9 BRIDGE",
    ind_funnel_scorecard(8, QUOTE_DT, BRIDGED_IND_CNT) AS "8 BRIDGE",
    ind_funnel_scorecard(7, QUOTE_DT, BRIDGED_IND_CNT) AS "7 BRIDGE",
    ind_funnel_scorecard(6, QUOTE_DT, BRIDGED_IND_CNT) AS "6 BRIDGE",
    ind_funnel_scorecard(5, QUOTE_DT, BRIDGED_IND_CNT) AS "5 BRIDGE",
    ind_funnel_scorecard(4, QUOTE_DT, BRIDGED_IND_CNT) AS "4 BRIDGE",
    ind_funnel_scorecard(3, QUOTE_DT, BRIDGED_IND_CNT) AS "3 BRIDGE",
    ind_funnel_scorecard(2, QUOTE_DT, BRIDGED_IND_CNT) AS "2 BRIDGE",
    -- AVG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "14 AVG", 
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "13 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "12 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "11 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "10 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "9 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "8 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "7 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "6 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "5 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "4 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "3 AVG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE())= 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN AVG_PREMIUM_XHIG ELSE 0 END) AS "2 AVG",
    -- HIG
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 14 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "14 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 13 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "13 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 12 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "12 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 11 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "11 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 10 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "10 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 9 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "9 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 8 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "8 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 7 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "7 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 6 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "6 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 5 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "5 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 4 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "4 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 3 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "3 HIG",
    SUM(CASE WHEN DATEDIFF(MONTH,QUOTE_DT,SYSDATE()) = 2 AND SUCCESS_IND = '1' AND CARRIERSQUOTED > 2  THEN ANNUALIZEDPREMIUM ELSE 0 END) AS "2 HIG",
    TO_CHAR(SYSDATE(),'MM-DD-YYYY') as AS_OF
    FROM "DSC_PLBI_DB"."APP_AGCY_PRD"."AGCY_COMP_RATER_AUTO_QTE_VW"
    GROUP BY KEY
)

SELECT * FROM
(
	SELECT * FROM market_index
	UNION ALL
	SELECT * FROM aarp_member
	UNION ALL
	SELECT * FROM aarp_thru
	UNION ALL
	SELECT * FROM pcarr
	UNION ALL
	SELECT * FROM pcarr_yr
	UNION ALL
	SELECT * FROM full_pay
	UNION ALL
	SELECT * FROM aqd_group
	UNION ALL
	SELECT * FROM acct_credit
	UNION ALL
	SELECT * FROM ins_age
	UNION ALL
	SELECT * FROM ins_score
	UNION ALL
	SELECT * FROM veh_cnt
	UNION ALL
	SELECT * FROM avg_mileage
	UNION ALL
	SELECT * FROM youthful
	UNION ALL
	SELECT * FROM household_comp
	UNION ALL
	SELECT * FROM cov_pkg
	UNION ALL
	SELECT * FROM bi_limit
	UNION ALL
	SELECT * FROM garage_sub
)
ORDER BY KEY;